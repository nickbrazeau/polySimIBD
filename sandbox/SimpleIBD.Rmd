---
title: "SimpleIBD"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{SimpleIBD}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)


# TODO add error in for mis call


```

```{r setup}
library(polySimIBD)

```

# Justification
Simple model because don't want to deal with levels of IBD


#### Simulate "Base" Population
First simulate a population of haploid samples using independent draws from a population with a known allele frequency distribution ($p$, $q$). 
```{r}

dat <- simPopData(pos = c(sort(sample(1e5, 1e2))),
                  nsamps = 100,
                  p_shape1 = 0.1,
                  p_shape2 = 0.1,
                  propMissing = 0)

dat.vcfR <- simPopData2vcfR(dat,
                            dp = 100,
                            dpstd = 5)

```

#### Make Samples IBD
Then make two samples IBD under the `hmmIBD` model framework. Presumambly, you want to make two samples IBD from the population you just simulated (but this not a requirement). 
```{r}

set.seed(44) # need those so we get a recombination event for one gen

simIBD.dat <- simIBD(smpl1 = dat$genmat$smp1, 
                     smpl2 = dat$genmat$smp100,
                     pos = dat$genmat$POS,
                     f = 0.5, k = 1, rho = 1e-5) 

  tibble::tibble(CHROM = dat$genmat$CHROM, POS = dat$genmat$POS,
                 IBDstate = simIBD.dat$simIBDvector) %>% 
    ggplot() + 
    geom_line(aes(x=POS, y=IBDstate)) +
    scale_y_continuous(breaks = c(0,1)) + 
    theme_minimal()


```

#### Make Mixtures 
```{r}

mix1 <- make_mixture(
  strains = list(
                  ibdsmple = simIBD.dat$smpl1,
                  mixsample = dat$genmat$smp2),
  strains.prop = c(50, 50),
  CHROMPOS = cbind.data.frame(dat$genmat$CHROM, dat$genmat$POS),
  dp = 100, 
  dpstd = 5,
  samplename = "IBDsmpl1_mixed")


mix2 <- make_mixture(
  strains = list(
                  ibdsmple = simIBD.dat$smpl2,
                  mixsample = dat$genmat$smp3),
  strains.prop = c(50, 50),
  CHROMPOS = cbind.data.frame(dat$genmat$CHROM, dat$genmat$POS),
  dp = 100, 
  dpstd = 5,
  samplename = "IBDsmpl2_mixed")


newvcfR.joined <- join_simvcfs(list(mix1, mix2, dat.vcfR))

```

##### Convert simVCFs to MIPanalyzer Object
```{r}
remotes::install_github("mrc-ide/MIPanalyzer")
library(MIPanalyzer)

MIPanalyzer::vcf2mipanalyzer_biallelic


```




