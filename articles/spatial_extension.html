<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extension of Structured Model for Spacee • polySimIBD</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extension of Structured Model for Spacee">
<meta property="og:description" content="polySimIBD">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">polySimIBD</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li>
      <a href="../articles/orig_mod_framework.html">Original Model Framework</a>
    </li>
    <li>
      <a href="../articles/spatial_extension.html">Spatial Extension</a>
    </li>
    <li>
      <a href="../articles/simdata.html">Simulating Genomic Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nickbrazeau/polySimIBD" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extension of Structured Model for Spacee</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nickbrazeau/polySimIBD/blob/HEAD/vignettes/spatial_extension.Rmd" class="external-link"><code>vignettes/spatial_extension.Rmd</code></a></small>
      <div class="hidden name"><code>spatial_extension.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nickbrazeau/polySimIBD" class="external-link">polySimIBD</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a></span><span class="op">)</span> <span class="co"># useful for manipulations &amp; visaulizations</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'tidygraph'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter</span></span></code></pre></div>
<div class="section level2">
<h2 id="extending-the-model-for-space">Extending the Model for Space<a class="anchor" aria-label="anchor" href="#extending-the-model-for-space"></a>
</h2>
<p>We extend the discrete-loci, discrete-time structured Wright Fisher
model for space by considering spatial <em>demes</em> as a collection of
hosts. Hosts move between demes based on the migration matrix
<em>M</em>. In line with the assumptions of the Wright-Fisher, the
number of hosts within the deme (i.e. deme size) does not change over
time. As a result, there are two levels of “structure”: (1)
<em>Hosts</em> which capture complexity of infection; (2) <em>Discrete
Locations</em> that contain a collection of hosts (i.e. spatial deme, or
“macrodeme”).</p>
<div class="section level3">
<h3 id="forwards-in-time-description">Forwards-in-time Description<a class="anchor" aria-label="anchor" href="#forwards-in-time-description"></a>
</h3>
<p>The full mathematical formulation of the nonspatial model can be
found in the Supplementary Section of <a href="https://www.nature.com/articles/s41467-020-15779-8" class="external-link">Verity,
Aydemir, Brazeau <em>et al.</em> Nat Comms 2020 (PMC7192906)</a>. The
spatial extension to the model is described in <a href="">Brazeau <em>et
al.</em> Biorxiv</a>.</p>
<p>In brief, we assume that each deme (<em>hereafter</em> macrodeme) is
a subpopulation within a very large population (<span class="math inline">\(\iota \in \nu\)</span>, where <span class="math inline">\(\iota\)</span> is an individual macrodeme and
<span class="math inline">\(\nu\)</span> is the total number of
macrodemes in the entire population) and that each macrodeme represents
a collection of individual hosts. Then, as before, let each individual
host be represented by a deme within a given macrodeme (<span class="math inline">\(i \in N_{\iota}\)</span>, where <span class="math inline">\(i\)</span> is an individual host and <span class="math inline">\(N_{\iota}\)</span> is the total host population
for that macrodeme).</p>
<p>We then allow the <span class="math inline">\(j\)</span> parasites
(that reside within the host deme) to mate at random with the previous
generation of parasites (<span class="math inline">\(t_{1-}\)</span>)
and produce a large number of parasite progeny. During mating, genetic
recombination has the potential to occur based on the length of the
genome and the recombination rate, <span class="math inline">\(\rho\)</span>. Progeny are then allowed to move to
a new macrodeme or stay in the current macrodeme based on the migration
matrix, <span class="math inline">\(\mathbf{M}\)</span>. Within a given
macrodeme, the progeny are then allowed migrate to a new host or stay
within the same host with a probability of <span class="math inline">\(\frac{m}{N_{\iota}}\)</span>. Finally - as before
- progeny are culled down to a smaller number of parasites per host by
drawing from a Poisson distribution with a mean COI. This process
produces the next generation of parasites within hosts at given discrete
locations. In essence, the non-spatial and spatial simulator only differ
by an additional hierarchical level of spatial “macrodemes”.</p>
<div class="section level4">
<h4 id="a-note-on-the-migration-matrix">A Note on the Migration Matrix<a class="anchor" aria-label="anchor" href="#a-note-on-the-migration-matrix"></a>
</h4>
<p>As part of the Wright-Fisher framework, for each generation a new set
of parents are drawn. As such, the migration matrix is parameterized to
look where parents originated versus where progeny may move, or put more
simply, the migration matrix represents “<strong>where one came
from</strong>” versus “where one is headed”. As such, this is a
“to-from” migration matrix, with the origin specified as columns and
destination in rows</p>
<p>Separately, please note is that the if you are using the migration
matrix as a probability matrix, rows must sum to 1 (valid marginal
probability); otherwise, values will be assumed to be rates and
converted to probabilities. The default value (1x1 matrix) of 1
indicates the non-spatial model.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="island-case">Island Case<a class="anchor" aria-label="anchor" href="#island-case"></a>
</h2>
<p>Here, we will simulate a case of two island populations (population A
vs. B) that are separated by a barrier to gene flow (i.e. there are no
connections between populations A and B).</p>
<p>Run the simulation:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># vectors must be ordered for population A and B</span></span>
<span><span class="va">demesizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">coimeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.25</span>, <span class="fl">1.25</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">migr_dist_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">migr_dist_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">swf</span> <span class="op">&lt;-</span> <span class="fu">polySimIBD</span><span class="fu">::</span><span class="fu"><a href="../reference/sim_swf.html">sim_swf</a></span><span class="op">(</span>pos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1e3</span>, size <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                           N <span class="op">=</span> <span class="va">demesizes</span>, </span>
<span>                           m <span class="op">=</span> <span class="va">m</span>, </span>
<span>                           mean_coi <span class="op">=</span> <span class="va">coimeans</span>, </span>
<span>                           migr_mat <span class="op">=</span> <span class="va">migr_dist_mat</span>, </span>
<span>                           rho <span class="op">=</span> <span class="fl">1e-2</span>, </span>
<span>                           tlim <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; completed in 0.000616 seconds</span></span></code></pre></div>
<p>Pull out the ARG and then calculate the pairwise IBD.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ARG</span> <span class="op">&lt;-</span> <span class="fu">polySimIBD</span><span class="fu">::</span><span class="fu"><a href="../reference/get_arg.html">get_arg</a></span><span class="op">(</span><span class="va">swf</span><span class="op">)</span></span>
<span><span class="co">#&gt; completed in 0.000509 seconds</span></span></code></pre></div>
<p>Next, calculate pairwise IBD for all combinations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># here we are going to get all the pairwise IBD combinations for our hosts</span></span>
<span><span class="va">adj_graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/combn.html" class="external-link">combn</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">demesizes</span><span class="op">)</span><span class="op">)</span>, m <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">.</span>, .name_repair <span class="op">=</span> <span class="st">"minimal"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">set_colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"smpl1"</span>, <span class="st">"smpl2"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pairwiseIBD <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_dbl</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">smpl1</span>, .y <span class="op">=</span> <span class="va">smpl2</span>, .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,  <span class="va">y</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu">quiet</span><span class="op">(</span><span class="fu">polySimIBD</span><span class="fu">::</span><span class="fu"><a href="../reference/get_bvibd.html">get_bvibd</a></span><span class="op">(</span>swf <span class="op">=</span> <span class="va">swf</span>, host_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># N.B. quiet is purely for aesthetic of vignette and is not needed in the above command</span></span></code></pre></div>
<p>Let’s visualize our simple scenarios</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adj_graph</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">smpl1</span>, y <span class="op">=</span> <span class="va">smpl2</span>, fill <span class="op">=</span> <span class="va">pairwiseIBD</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="st">"Pairwise IBD"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Sample 1"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Sample 2"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Samples 1:10 are on island A; Samples 11:25 are on island B"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_extension_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>As can be seen from the figure, samples 1-10, which reside on island
A have no relatedness to samples 11-25 that reside on island by B, as
they have been completely isolated through our migration matrix.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The spatial extension of the discrete-loci, discrete-time structured
Wright Fisher model allows for complex simulations and demographies to
be considered.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nick Brazeau, Bob Verity.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
